/*! sectionsjs - v0.1.3 - 2014-01-17 | Copyright (c) 2013 Po-Ying Chen <poying.me@gmail.com> */


!function(a,b){"use strict";var c=a.sections={};c.config={className:"section",containerClassName:"section__container",marginTop:0,autoSectionHeight:!0,magnet:!1},c.utils={},c.utils.getInlineCSS=function(a){if(a.__style)return a.__style;var b=a.getAttribute("style")||"",c=/([^:\s]+)\s*:\s*([^;]+)/g,d={};return b.replace(c,function(a,b,c){d[b]=c.trim()}),a.__style=d,d},c.utils.setInlineCSS=function(a,b){var d,e=c.utils.getInlineCSS(a),f=[];for(d in b)b.hasOwnProperty(d)&&(e[d]=b[d]);for(d in e)e.hasOwnProperty(d)&&f.push(d+": "+e[d]);return a.setAttribute("style",f.join("; ")),e},c.utils.forEach=function(a,b){a||(a=[]),b||(b=function(){});var c,d,e=a.length;for(c=0;e>c&&(d=a[c],b(d,c)!==!1);c+=1);},c.utils.getVendorPrefix=function(){var c,d=a.getComputedStyle;if(d){var e,f=d(b.documentElement,"");f=Array.prototype.join.call(f,""),e=f.match(/-(?:O|Moz|webkit|ms)-/i),e&&(c=e[0])}return c},c.utils.needPrefix=function(c){var d=a.getComputedStyle;if(d){var e=new RegExp("^-\\w+-"+(c||""),"m");return e.test(Array.prototype.join.call(d(b.body),"\n"))}return!1},c.utils.clone=function(a){var b,c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c},c.events={},c.events.EventEmitter=function(){{var a=function(){this.events={}},b=a.prototype.on=function(a,b,c){var d=this.events;return"function"==typeof b&&(b.once=!!c,d[a]||(d[a]=[]),d[a].push(b)),this},c=(a.prototype.addEventListener=b,a.prototype.once=function(a,b){return this.on(a,b,!0)},a.prototype.off=function(a,b){var c=this.events;if("function"==typeof b)for(var d=c[a]||[],e=d.length;e--;)d[e]===b&&d.splice(e,1);else delete c[a];return this}),d=(a.prototype.removeEventListener=c,a.prototype.emit=function(a){for(var b=Array.prototype.slice.call(arguments,1),c=this.events[a]||[],d=c.length;d--;)c[d].apply(this,b),c[d].once&&c.splice(d,1);return this});a.prototype.trigger=d}return a}(),c.Transition=function(){var a=function(b){this.__options=a.getOptions(b),this.values=[]};return a.prototype.update=function(b){var d,e=this.__options.easing,f=this.__options.afterCalculate;return b=this.getProgress(b),e?this.__options.values?(d=[],c.utils.forEach(this.__options.values,function(a){d.push(f(e(b,a.from,a.to)))})):d=[f(e(b,this.__options.from,this.__options.to))]:d=this.getValue(b),a.format(this.__options.format,d)},a.prototype.getProgress=function(a){var b;switch(!0){case a<=this.__options.start:b=0;break;case a>=this.__options.end:b=100;break;default:var c=this.__options.end-this.__options.start,d=a-this.__options.start;b=d/c*100}return b},a.prototype.getValue=function(a){var b,c=this.__options.values,d=this.__options.afterCalculate;if(c){var e,f,g=c.length;for(b=[],f=0;g>f;f+=1)e=c[f],b.push(d(this.calcValue(e,a)))}else b=[d(this.calcValue(this.__options,a))];return b},a.prototype.calcValue=function(a,b){var c=a.from,d=a.to;return(d-c)/100*b+c},a.prototype.getKey=function(a){var b=this.__options.key;return a&&(b=a+b[0].toUpperCase()+b.slice(1)),b},a.prototype.getTarget=function(){return this.__options.target},a.getOptions=function(b){b||(b={});var c,d=a.defaultOptions;for(c in d)d.hasOwnProperty(c)&&!b.hasOwnProperty(c)&&(b[c]=d[c]);return b},a.defaultOptions={key:null,start:0,end:100,from:0,to:0,values:null,format:"%s",easing:null,target:null,prefix:!1,afterCalculate:function(a){return a}},a.format=function(a,b){var c=0;return a.replace(/\\%s/g,"￿").replace(/%s/g,function(){return b[c++]}).replace(/￿/g,"%s")},a}(),c.Section=function(){var a=function(a,b,d){c.events.EventEmitter.call(this),this.sections=d,this.element=a,this.container=b||{style:{}},this.updatePosition(),this.progress=0,this.visible=!0,this.__transitions=[],this.__transitionTargets=[]};return a.prototype=new c.events.EventEmitter,a.prototype.updatePosition=function(){var a=this.getOffset();return this.top=a.top,this},a.prototype.getOffset=function(){for(var a=this.element,b=0,c=0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent;return{top:c,left:b}},a.prototype.show=function(){this.visible||(this.container.style.display="block",this.visible=!0,this.emit("show"))},a.prototype.hide=function(){this.visible&&(this.container.style.display="none",this.visible=!1,this.emit("hide"))},a.prototype.getCSS=function(a){var b=c.utils.getInlineCSS(this.element);return a?b[a]:b},a.prototype.setCSS=function(a){return c.utils.setInlineCSS(this.element,a),this},a.prototype.updateProgress=function(a,b){var c,d=this.getHeight();if(a+b>this.top&&a<=this.top+d){var e=this.top-a;c=e/(e>0?b:d)*100,c=c>0?100-c:-1*c+100}else c=this.top-a>0?0:200;return this.progress!==c&&(this.runTransition(c),this.progress=c,this.emit("progress",c)),this},a.prototype.getHeight=function(){var a=this.element;return a.offsetHeight||a.clientHeight||a.scrollHeight},a.prototype.transitions=function(a){var b=this.__transitions;return c.utils.forEach(a,function(a){a.target=a.target||a.targets||[],void 0===a.prefix&&(a.prefix=c.utils.needPrefix(a.key));var d=a.target instanceof Array?a.target:[a.target];c.utils.forEach(d,function(){var d=c.utils.clone(a);d.target=this.setTarget(a.target),b.push(new c.Transition(d))}.bind(this))}.bind(this)),this},a.prototype.setTarget=function(a){var b=this.__transitionTargets,c=b.indexOf(a);return~c||(b.push(a),c=b.length-1),c},a.prototype.runTransition=function(a){var b=this.__transitions,d=this.__transitionTargets,e=c.utils.forEach;e(b,function(b){var c=b.getTarget(),e=d[c].style;e[b.getKey(b.__options.prefix?this.sections.__prefix:null)]=b.update(a)}.bind(this))},a}(),c.Animate=function(){function a(a,b,c){this.id=0,this.startTime=0,this.started=!1,this.speed=b||300,this.fn=a,this.easing=c}return a.prototype=new c.events.EventEmitter,a.prototype.loop=function(){this.id=c.requestAnimationFrame(function(){var a=(Date.now()-this.startTime)/this.speed;this.easing&&(a=this.easing(a)),a>=1?(this.fn(1),this.emit("done")):(this.fn(a),this.loop())}.bind(this))},a.prototype.stop=function(){return this.started&&c.cancelAnimationFrame(this.id),this.started=!1,this.emit("stopped"),this},a.prototype.start=function(){return this.started||(this.startTime=Date.now(),this.started=!0,this.emit("started"),this.loop()),this},a}(),c.proto=new c.events.EventEmitter,c.proto.init=function(){return this.__started=!1,this.__init=!0,this.__running=!1,this.__prefix=null,this.__magneticTimer=null,this.__magneticAnimation=null,this.detectCSSPrefix(),this.getSections(),this.updateWindowSize(),this.getScrollHeight(),this.addWindowResizeHandler(),this.addScrollHandler(),this.updateProgress(),this.lazyApply(),this.onScrollHandler=this.onScrollHandler.bind(this),this.loop=this.loop.bind(this),this.onScrollHandler(),this},c.proto.detectCSSPrefix=function(){var a={"-webkit-":"webkit","-moz-":"Moz","-ms-":"ms","-o-":"O"};this.__prefix=a[c.utils.getVendorPrefix()]},c.proto.getScrollHeight=function(){var a=b.body,c=b.documentElement;return this.scrollHeight=a.scrollHeight||c.scrollHeight||0,this},c.proto.getSections=function(){this.sections=[];var a=b.getElementsByClassName(this.config.className);return c.utils.forEach(a,function(a){var b=a.querySelector("."+this.config.containerClassName);this.sections.push(new c.Section(a,b,this))}.bind(this)),this},c.proto.start=function(){return this.onScrollHandler(),this.__init&&!this.__started&&(a.addEventListener("scroll",this.onScrollHandler),this.__started=!0,this.emit("started")),this},c.proto.stop=function(){this.__started&&(a.removeEventListener("scroll",this.onScrollHandler),this.__started=!1,this.emit("stopped"))},c.proto.onScrollHandler=function(){this.__running||(this.__magneticAnimation&&this.__magneticAnimation.scrollTop!==b.documentElement.scrollTop&&this.__magneticAnimation.stop(),this.__running=!0,this.__intervalID=this.requestAnimationFrame(this.loop))},c.proto.loop=function(){this.config.magnet&&null===this.__magneticAnimation&&this.magnet();var c={x:0,y:0};a.pageYOffset?(c.y=a.pageYOffset,c.x=a.pageXOffset):b.body&&b.documentElement.scrollLeft?(c.y=b.documentElement.scrollTop,c.x=b.documentElement.scrollLeft):b.documentElement&&b.documentElement.scrollLeft&&(c.y=b.documentElement.scrollTop,c.x=b.documentElement.scrollLeft),this.top=c.y,this.left=c.x,this.checkCurrentSection(),this.updateProgress(),this.__running=!1},c.proto.requestAnimationFrame=function(){return(a.requestAnimationFrame||a.mozRequestAnimationFrame||a.webkitRequestAnimationFrame||a.msRequestAnimationFrame||setTimeout).bind(a)}(),c.proto.cancelAnimationFrame=function(){return(a.cancelAnimationFrame||a.mozcancelAnimationFrame||a.webkitcancelAnimationFrame||a.mscancelAnimationFrame||setInterval).bind(a)}(),c.proto.updateWindowSize=function(){var c=b.documentElement,d=b.body,e=a.innerWidth||c.clientWidth||d.clientWidth,f=a.innerHeight||c.clientHeight||d.clientHeight;return this.width=e,this.height=f,this.config.autoSectionHeight&&this.each(function(a,b){b.setCSS({height:f+"px"}),b.updatePosition()}),this},c.proto.addWindowResizeHandler=function(){var b=function(){this.updateWindowSize()}.bind(this);return a.addEventListener("resize",b),b(),this},c.proto.addScrollHandler=function(){a.addEventListener("scroll",function(){this.start()}.bind(this))},c.proto.checkCurrentSection=function(){var a=this.__currentIndex,b=!1,c=this.top+this.height;return this.each(function(d,e){var f=e.top+e.getHeight();if(!b&&this.top>=e.top&&this.top<f&&d!==a){this.__currentIndex=d;var g=this.get(a);this.emit("changed",e,g),g&&g.emit("scrollOut",d>a?1:-1),e.emit("scrollIn",a>d?1:-1),b=!0}this.top>f||e.top>c?e.hide():e.show()}.bind(this)),this},c.proto.updateProgress=function(){var a=this.last(),b=this.top/(this.scrollHeight-a.getHeight())*100;return this.progress!==b&&(this.progress=b,this.emit("progress",b),this.each(function(a,b){b.updateProgress(this.top,this.height)}.bind(this))),this},c.proto.lazyApply=function(){for(var a=this.__lazyApply,b=a.length;b--;)a[b]();return this},c.proto.current=function(){return this.get(this.currentIndex())},c.proto.last=function(){return this.get(this.sections.length-1)},c.proto.first=function(){return this.get(0)},c.proto.currentIndex=function(){return 0|this.__currentIndex},c.proto.get=function(a){return this.sections[a]||null},c.proto.getCurrentSection=function(){return this.get(this.currentIndex())},c.proto.section=function(a,b){if(this.__init){if("function"==typeof b){switch(a){case"first":a=0;break;case"last":a=this.sections.length-1;break;default:a=0|a}var c=this.get(a);c&&b.call(c,c)}}else this.__lazyApply.push(function(){this.section(a,b)}.bind(this));return this},c.proto.each=function(a){return c.utils.forEach(this.sections,function(b,c){return a.call(b,c,b)===!1?!1:void 0}),this},c.proto.magnet=function(){clearTimeout(this.__magneticTimer),this.__magneticAnimation&&this.__magneticAnimation.stop(),this.__magneticTimer=setTimeout(function(){this.__magneticAnimation=this.scrollTo(this.getCurrentSection(),1e3);var a=this.magnetDone.bind(this);this.__magneticAnimation.once("done",a),this.__magneticAnimation.once("stopped",a),this.__magneticAnimation.start()}.bind(this),500)},c.proto.magnetDone=function(){this.__magneticAnimation=null},c.proto.scrollTo=function(a,d,e){a instanceof c.Section||(a=this.get(a));var f=a.top-this.top,g=this.top,h=new c.Animate(function(a){h.scrollTop=b.documentElement.scrollTop=g+f*a|0}.bind(this),d,e);return h},c.Sections=function(a){c.events.EventEmitter.call(this),a=a||{};var b,d=c.config;for(b in d)d.hasOwnProperty(b)&&!a.hasOwnProperty(b)&&(a[b]=d[b]);this.__started=!1,this.__currentIndex=-1,this.config=a,this.width=0,this.height=0,this.top=0,this.left=0,this.__lazyApply=[]},c.Sections.prototype=c.proto,c.requestAnimationFrame=c.proto.requestAnimationFrame,c.cancelAnimationFrame=c.proto.cancelAnimationFrame,c.create=function(a){return new c.Sections(a)}}(this,this.document);
//# sourceMappingURL=dist/sectionsjs.map